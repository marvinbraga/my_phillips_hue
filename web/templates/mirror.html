<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espelhamento de Tela - Marvin Hue</title>
    <link rel="icon" href="/static/favicon.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
          crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
        }
        .theme-toggle .btn {
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: transform 0.3s ease;
        }
        .theme-toggle .btn:hover {
            transform: scale(1.1);
        }

        .mirror-status {
            font-size: 1.5rem;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        .mirror-status.active {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
            animation: pulse 2s infinite;
        }
        .mirror-status.inactive {
            background: var(--bs-secondary-bg);
            color: var(--bs-body-color);
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(0, 184, 148, 0.4); }
            50% { box-shadow: 0 0 0 15px rgba(0, 184, 148, 0); }
        }

        .control-btn {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            font-size: 2rem;
            transition: all 0.3s ease;
        }
        .control-btn:hover {
            transform: scale(1.1);
        }
        .control-btn.start-btn {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            border: none;
            color: white;
        }
        .control-btn.stop-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            border: none;
            color: white;
        }

        .color-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
        }
        .color-item {
            text-align: center;
        }
        .color-swatch {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid var(--bs-body-color);
            margin-bottom: 0.5rem;
            transition: background-color 0.3s ease;
        }
        .color-name {
            font-size: 0.75rem;
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .settings-card {
            background: var(--bs-body-bg);
        }

        .monitor-preview {
            position: relative;
            width: 100%;
            max-width: 400px;
            aspect-ratio: 16/9;
            border: 3px solid var(--bs-body-color);
            border-radius: 8px;
            margin: 0 auto;
            overflow: hidden;
            background: #1a1a2e;
        }
        .monitor-preview .region {
            position: absolute;
            opacity: 0.7;
            transition: background-color 0.3s ease;
        }
        .monitor-preview .region-left { left: 0; top: 20%; width: 15%; height: 60%; }
        .monitor-preview .region-right { right: 0; top: 20%; width: 15%; height: 60%; }
        .monitor-preview .region-top { left: 20%; top: 0; width: 60%; height: 15%; }
        .monitor-preview .region-bottom { left: 20%; bottom: 0; width: 60%; height: 15%; }
        .monitor-preview .region-top-left { left: 0; top: 0; width: 25%; height: 25%; }
        .monitor-preview .region-top-right { right: 0; top: 0; width: 25%; height: 25%; }
        .monitor-preview .region-bottom-left { left: 0; bottom: 0; width: 25%; height: 25%; }
        .monitor-preview .region-bottom-right { right: 0; bottom: 0; width: 25%; height: 25%; }
        .monitor-preview .region-center { left: 30%; top: 30%; width: 40%; height: 40%; border-radius: 8px; }
        .monitor-preview .region-ambient { left: 0; top: 0; width: 100%; height: 100%; opacity: 0.3; z-index: -1; }
    </style>
</head>
<body>
<div class="theme-toggle">
    <button id="theme-btn" class="btn btn-outline-secondary" title="Alternar tema">
        <i id="theme-icon" class="bi bi-moon-fill"></i>
    </button>
</div>

<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Controle</a></li>
            <li class="breadcrumb-item"><a href="/positions-config">Posicionamento</a></li>
            <li class="breadcrumb-item active">Espelhamento</li>
        </ol>
    </nav>

    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1><i class="bi bi-display"></i> Espelhamento de Tela</h1>
            <small id="bridge-status" class="text-muted">
                <i class="bi bi-circle-fill text-warning"></i> Verificando conexão...
            </small>
        </div>
        <span id="connection-status" class="text-muted">
            <i class="bi bi-wifi-off"></i> Conectando...
        </span>
    </div>
    <p class="text-muted mt-2">Sincronize as cores das lâmpadas com o conteúdo da sua tela em tempo real.</p>

    <div class="row">
        <div class="col-lg-6 mb-4">
            <!-- Status e Controle Principal -->
            <div class="card">
                <div class="card-body">
                    <div id="mirror-status" class="mirror-status inactive mb-4">
                        <i class="bi bi-display"></i>
                        <div id="status-text">Espelhamento Inativo</div>
                    </div>

                    <div class="d-flex justify-content-center gap-4 mb-4">
                        <button id="start-btn" class="btn control-btn start-btn" title="Iniciar">
                            <i class="bi bi-play-fill"></i>
                        </button>
                        <button id="stop-btn" class="btn control-btn stop-btn" title="Parar" disabled>
                            <i class="bi bi-stop-fill"></i>
                        </button>
                    </div>

                    <!-- Preview do Monitor -->
                    <div class="monitor-preview" id="monitor-preview">
                        <div class="region region-top-left" data-position="top-left"></div>
                        <div class="region region-top" data-position="top"></div>
                        <div class="region region-top-right" data-position="top-right"></div>
                        <div class="region region-left" data-position="left"></div>
                        <div class="region region-center" data-position="center"></div>
                        <div class="region region-right" data-position="right"></div>
                        <div class="region region-bottom-left" data-position="bottom-left"></div>
                        <div class="region region-bottom" data-position="bottom"></div>
                        <div class="region region-bottom-right" data-position="bottom-right"></div>
                        <div class="region region-ambient" data-position="ambient"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <!-- Configurações -->
            <div class="card settings-card mb-4">
                <div class="card-header">
                    <i class="bi bi-sliders"></i> Configurações
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="fps-range" class="form-label">
                            Taxa de Atualização: <span id="fps-value">25</span> FPS
                        </label>
                        <input type="range" class="form-range" id="fps-range"
                               min="10" max="30" value="25" step="5">
                        <div class="form-text">Maior FPS = mais responsivo, mais uso de CPU</div>
                    </div>

                    <div class="mb-3">
                        <label for="brightness-range" class="form-label">
                            Brilho: <span id="brightness-value">200</span>
                        </label>
                        <input type="range" class="form-range" id="brightness-range"
                               min="50" max="254" value="200">
                    </div>

                    <div class="mb-3">
                        <label for="saturation-range" class="form-label">
                            Boost de Saturação: <span id="saturation-value">1.2</span>x
                        </label>
                        <input type="range" class="form-range" id="saturation-range"
                               min="1.0" max="2.0" value="1.2" step="0.1">
                        <div class="form-text">Aumenta a intensidade das cores</div>
                    </div>

                    <div class="mb-3">
                        <label for="smoothing-range" class="form-label">
                            Suavização: <span id="smoothing-value">0.3</span>
                        </label>
                        <input type="range" class="form-range" id="smoothing-range"
                               min="0.1" max="1.0" value="0.3" step="0.1">
                        <div class="form-text">Menor = transições mais suaves, Maior = mais responsivo</div>
                    </div>

                    <div class="mb-3">
                        <label for="transition-range" class="form-label">
                            Tempo de Transição: <span id="transition-value">50</span>ms
                        </label>
                        <input type="range" class="form-range" id="transition-range"
                               min="0" max="10" value="0.5" step="0.5">
                        <div class="form-text">0 = instantâneo, 10 = 1 segundo</div>
                    </div>

                    <button id="apply-settings-btn" class="btn btn-outline-primary">
                        <i class="bi bi-check-lg"></i> Aplicar Configurações
                    </button>
                </div>
            </div>

            <!-- Cores Atuais -->
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-palette"></i> Cores Atuais
                </div>
                <div class="card-body">
                    <div id="color-preview" class="color-preview">
                        <div class="text-muted">Inicie o espelhamento para ver as cores</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Link para configuração de posições -->
    <div class="alert alert-info">
        <i class="bi bi-info-circle"></i>
        Configure a posição das lâmpadas em <a href="/positions-config">Posicionamento</a>
        para definir quais regiões da tela cada lâmpada deve capturar.
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="/static/mirror.js"></script>
</body>
</html>
